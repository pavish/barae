---
phase: 01-foundation-auth
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - frontend/src/features/dashboard/components/DashboardLayout.tsx
  - frontend/src/features/dashboard/components/Header.tsx
  - frontend/src/features/dashboard/components/Sidebar.tsx
  - frontend/src/features/dashboard/components/MobileNav.tsx
  - frontend/src/features/dashboard/components/UserMenu.tsx
  - frontend/src/features/dashboard/components/VerificationBanner.tsx
  - frontend/src/features/dashboard/components/EmptyState.tsx
  - frontend/src/features/dashboard/pages/DashboardPage.tsx
  - frontend/src/features/settings/pages/SettingsPage.tsx
  - frontend/src/features/settings/components/ProfileSection.tsx
  - frontend/src/features/settings/components/SecuritySection.tsx
  - frontend/src/features/settings/components/AppearanceSection.tsx
  - frontend/src/features/settings/components/DangerZone.tsx
  - frontend/src/shared/components/ThemeToggle.tsx
  - frontend/src/shared/components/Modal.tsx
  - frontend/src/routes/index.tsx
autonomous: false

must_haves:
  truths:
    - "User sees dashboard after login with responsive navigation"
    - "Unverified users see persistent verification banner"
    - "User can toggle between light, dark, and system theme"
    - "User can log out from user menu"
    - "User can change password in settings"
    - "User can delete account from settings danger zone"
    - "Dashboard works well on mobile devices"
  artifacts:
    - path: "frontend/src/features/dashboard/components/DashboardLayout.tsx"
      provides: "Main layout wrapper with header and sidebar"
      contains: "Sidebar"
    - path: "frontend/src/features/dashboard/components/VerificationBanner.tsx"
      provides: "Email verification reminder banner"
      contains: "emailVerified"
    - path: "frontend/src/features/settings/pages/SettingsPage.tsx"
      provides: "Account settings page"
      contains: "ProfileSection"
    - path: "frontend/src/shared/components/ThemeToggle.tsx"
      provides: "Light/dark/system theme switcher"
      contains: "useTheme"
  key_links:
    - from: "frontend/src/features/dashboard/components/DashboardLayout.tsx"
      to: "frontend/src/features/dashboard/components/Sidebar.tsx"
      via: "Component composition"
      pattern: "<Sidebar"
    - from: "frontend/src/features/dashboard/components/UserMenu.tsx"
      to: "signOut"
      via: "better-auth signOut"
      pattern: "signOut"
    - from: "frontend/src/features/settings/components/SecuritySection.tsx"
      to: "/api/auth/change-password"
      via: "better-auth changePassword"
      pattern: "changePassword"
---

<objective>
Build the responsive dashboard shell with navigation, settings page, and visual polish

Purpose: Complete the Phase 1 user experience with a functional dashboard that users land on after authentication. Includes responsive navigation, theme switching, settings management, and the verification banner for unverified users.

Output: Polished, responsive dashboard with working navigation, settings, logout, and theme toggle
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-CONTEXT.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
@.planning/phases/01-foundation-auth/01-01-SUMMARY.md
@.planning/phases/01-foundation-auth/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard layout with responsive navigation</name>
  <files>
    frontend/src/features/dashboard/components/DashboardLayout.tsx
    frontend/src/features/dashboard/components/Header.tsx
    frontend/src/features/dashboard/components/Sidebar.tsx
    frontend/src/features/dashboard/components/MobileNav.tsx
    frontend/src/features/dashboard/components/UserMenu.tsx
    frontend/src/features/dashboard/components/VerificationBanner.tsx
    frontend/src/shared/components/ThemeToggle.tsx
    frontend/src/shared/components/Modal.tsx
    frontend/src/routes/index.tsx
  </files>
  <action>
1. Create `frontend/src/shared/components/Modal.tsx`:
   - Accept isOpen, onClose, title, children props
   - Overlay with backdrop blur
   - Centered content card
   - Close on overlay click and Escape key
   - Focus trap (optional, can be basic for now)
   - Dark mode styling

2. Create `frontend/src/shared/components/ThemeToggle.tsx`:
   - Use useTheme hook from shared/hooks
   - Three-way toggle or dropdown: Light | Dark | System
   - Show icons for each mode (sun, moon, monitor)
   - Persist selection immediately

3. Create `frontend/src/features/dashboard/components/Header.tsx`:
   - Fixed top header
   - Left: Barae logo (text or simple SVG)
   - Center: Search bar (placeholder - disabled with "Coming soon" tooltip)
   - Right: ThemeToggle + UserMenu
   - Responsive: hide search on small screens, adjust spacing

4. Create `frontend/src/features/dashboard/components/UserMenu.tsx`:
   - Dropdown triggered by user avatar (or initials circle if no avatar)
   - Show user name and email at top
   - Menu items: Settings (link to /settings), Logout
   - Logout calls signOut() then redirects to /auth
   - Use a simple dropdown implementation or headless UI pattern

5. Create `frontend/src/features/dashboard/components/Sidebar.tsx`:
   - Desktop sidebar (left, fixed width ~240px)
   - Navigation items with icons:
     - Dashboard (home icon)
     - Sites (grid/folder icon) - placeholder, grayed out "Coming in Phase 3"
     - Settings (gear icon)
   - Active state styling for current route
   - Collapsible on medium screens (icon-only mode)
   - Hidden on mobile (use MobileNav instead)

6. Create `frontend/src/features/dashboard/components/MobileNav.tsx`:
   - Bottom navigation bar on mobile (below md breakpoint)
   - Same items as Sidebar but horizontal
   - Icons with small labels below
   - Fixed to bottom of screen
   - Hide on desktop

7. Create `frontend/src/features/dashboard/components/VerificationBanner.tsx`:
   - Check session.user.emailVerified
   - If false, show persistent yellow/warning banner at top of content area
   - Text: "Please verify your email to unlock all features"
   - Button: "Resend verification email"
   - On click, call sendVerificationEmail and show "Sent!" feedback
   - Dismissible for session (localStorage flag, reappears on next session)

8. Create `frontend/src/features/dashboard/components/DashboardLayout.tsx`:
   - Compose: Header (fixed top), Sidebar (desktop), MobileNav (mobile)
   - Main content area with proper padding
   - VerificationBanner appears above content if needed
   - Use Outlet for nested route content

9. Update `frontend/src/routes/index.tsx`:
   - Wrap protected routes with DashboardLayout
   - Structure:
     ```
     / -> redirect to /dashboard
     /auth, /auth/forgot-password, /auth/reset-password -> public
     /dashboard -> DashboardLayout
       /dashboard (index) -> DashboardPage
       /settings -> SettingsPage
     ```

From CONTEXT.md decisions:
- Adaptive navigation optimized per viewport
- Header: Barae logo, search bar, user avatar menu
- Navigation should be "useful and frictionless"
  </action>
  <verify>
    1. Log in and navigate to /dashboard
    2. See header with logo, search (disabled), theme toggle, user menu
    3. See sidebar on desktop with Dashboard, Sites (disabled), Settings
    4. Resize to mobile - sidebar disappears, bottom nav appears
    5. Click user menu - see name, email, Settings, Logout
    6. Click theme toggle - theme changes and persists on refresh
    7. If unverified user, see verification banner
  </verify>
  <done>
    DashboardLayout renders with responsive navigation. Header has logo, search placeholder, theme toggle, user menu. Sidebar on desktop, bottom nav on mobile. Verification banner shows for unverified users. Navigation between pages works.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build settings page with all sections</name>
  <files>
    frontend/src/features/settings/pages/SettingsPage.tsx
    frontend/src/features/settings/components/ProfileSection.tsx
    frontend/src/features/settings/components/SecuritySection.tsx
    frontend/src/features/settings/components/AppearanceSection.tsx
    frontend/src/features/settings/components/DangerZone.tsx
    frontend/src/features/settings/schemas/settings.ts
  </files>
  <action>
1. Create Zod schemas in `frontend/src/features/settings/schemas/settings.ts`:
   - profileSchema: name (min 2 chars)
   - passwordSchema: currentPassword, newPassword (min 8), confirmPassword - with refine
   - deleteAccountSchema: confirmText (must equal "DELETE")

2. Create `frontend/src/features/settings/components/ProfileSection.tsx`:
   - Card with "Profile" heading
   - Display current email (read-only, with verified badge if verified)
   - Editable name field with Save button
   - If not verified, show "Resend verification email" link
   - Use react-hook-form for name edit
   - On save, call API to update user (better-auth updateUser or custom endpoint)

3. Create `frontend/src/features/settings/components/SecuritySection.tsx`:
   - Card with "Security" heading
   - Password change form:
     - Current password
     - New password
     - Confirm new password
   - Submit calls better-auth changePassword
   - Show success/error feedback
   - Note: If user signed up with GitHub only, may not have password - handle gracefully

4. Create `frontend/src/features/settings/components/AppearanceSection.tsx`:
   - Card with "Appearance" heading
   - Theme selection (expanded version of ThemeToggle)
   - Radio or segmented control: Light | Dark | System
   - Show current selection
   - Preview of what each looks like (optional, simple colored squares)

5. Create `frontend/src/features/settings/components/DangerZone.tsx`:
   - Card with red border, "Danger Zone" heading
   - "Delete Account" button (red/danger variant)
   - On click, show confirmation modal:
     - Warning text about permanent deletion
     - Input: type "DELETE" to confirm
     - Cancel and Delete buttons
   - On confirm, call API to delete account
   - After deletion, redirect to /auth with message

6. Create `frontend/src/features/settings/pages/SettingsPage.tsx`:
   - Page title: "Settings"
   - Stack sections vertically with spacing:
     - ProfileSection
     - SecuritySection
     - AppearanceSection
     - DangerZone (at bottom, separated)
   - Responsive: single column on mobile, can be wider card on desktop

From CONTEXT.md decisions:
- Profile: name, email display
- Password change
- Email verification status
- Theme preference
- Danger zone with account deletion
  </action>
  <verify>
    1. Navigate to /settings from sidebar or user menu
    2. See Profile section with email and name
    3. Edit name, save - should update (check session refreshes)
    4. See Security section with password change form
    5. See Appearance section with theme options
    6. See Danger Zone with delete account
    7. Click delete - modal appears with confirmation input
    8. Test password change flow (may need to create test account)
  </verify>
  <done>
    SettingsPage renders with all four sections. Name can be edited and saved. Password can be changed. Theme can be changed from settings. Account deletion shows confirmation modal. All forms validate properly.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create dashboard empty state and polish</name>
  <files>
    frontend/src/features/dashboard/components/EmptyState.tsx
    frontend/src/features/dashboard/pages/DashboardPage.tsx
    frontend/src/index.css
  </files>
  <action>
1. Create `frontend/src/features/dashboard/components/EmptyState.tsx`:
   - Centered content for empty dashboard
   - Onboarding checklist per CONTEXT.md:
     1. Verify email (checkbox, linked to verification banner/resend)
     2. Connect GitHub (checkbox, disabled "Coming in Phase 2")
     3. Create site (checkbox, disabled "Coming in Phase 3")
   - Each item shows status: completed (checkmark), pending (empty circle), locked (lock icon)
   - Verified email shows checkmark if emailVerified is true
   - Friendly welcome message: "Welcome to Barae! Let's get you set up."

2. Create `frontend/src/features/dashboard/pages/DashboardPage.tsx`:
   - Check if user has any sites (for now, always empty)
   - If empty, show EmptyState
   - If has sites, show site list (placeholder for Phase 3)
   - For Phase 1, always shows EmptyState

3. Polish `frontend/src/index.css`:
   - Ensure smooth transitions for theme changes
   - Add any global utility classes needed
   - Ensure focus states are visible and accessible
   - Add scrollbar styling for dark mode (webkit)

4. Final polish pass:
   - Check all pages have consistent spacing
   - Verify loading states don't flash awkwardly
   - Check error states are styled consistently
   - Verify all interactive elements have hover/focus states
   - Test keyboard navigation through main flows
  </action>
  <verify>
    1. Navigate to /dashboard
    2. See empty state with onboarding checklist
    3. Verify email item shows correct status based on emailVerified
    4. GitHub and Create Site items show as locked/coming soon
    5. Theme transitions are smooth
    6. All elements have proper focus states for keyboard nav
  </verify>
  <done>
    DashboardPage shows EmptyState with onboarding checklist. Checklist reflects actual email verification status. UI is polished with consistent spacing, transitions, and focus states.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 1 authentication and dashboard experience:
    - Login/Signup with email and GitHub OAuth
    - Password reset flow
    - Responsive dashboard with adaptive navigation
    - Settings page with profile, security, appearance, danger zone
    - Dark mode with light/dark/system options
    - Email verification banner for unverified users
    - Onboarding checklist in empty state
  </what-built>
  <how-to-verify>
    1. **Auth Flow:**
       - Visit http://localhost:5173/auth
       - Create a new account (sign up)
       - Verify you're redirected to dashboard
       - Log out from user menu
       - Log back in with same credentials
       - Try GitHub OAuth (if configured)

    2. **Dashboard Layout:**
       - On desktop: verify sidebar with navigation items
       - Resize to mobile: verify bottom navigation appears
       - Click through navigation items
       - Verify search bar shows "Coming soon" (disabled)

    3. **Theme:**
       - Toggle between light, dark, and system themes
       - Refresh page - theme should persist
       - Check system theme follows OS preference

    4. **Verification Banner:**
       - If account email is unverified, banner should appear
       - Click "Resend verification email"
       - Verify email is sent (check logs or inbox)

    5. **Settings:**
       - Navigate to Settings
       - Edit name and save
       - Try changing password (if applicable)
       - Verify theme can be changed from settings
       - Click "Delete Account" - verify confirmation modal

    6. **Mobile Experience:**
       - Open in mobile viewport (or actual phone)
       - Verify all interactions work
       - Check navigation is usable
       - Verify forms are usable on small screens

    7. **Empty State:**
       - Dashboard shows onboarding checklist
       - Email verification status is accurate
       - Future items are properly marked as coming soon
  </how-to-verify>
  <resume-signal>Type "approved" if all flows work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Complete Phase 1 verification checklist:

**Requirements Coverage:**
- [ ] AUTH-01: User can sign up with email and password
- [ ] AUTH-02: User receives email verification after signup
- [ ] AUTH-03: User can log in with email/password
- [ ] AUTH-04: User can log in with GitHub OAuth
- [ ] AUTH-05: User can reset password via email link
- [ ] AUTH-06: User session persists across browser sessions
- [ ] AUTH-07: User can log out from any page
- [ ] DASH-01: React + Vite dashboard for all user interactions
- [ ] DASH-02: Dashboard is fully responsive
- [ ] DASH-03: Dashboard and editor work well on mobile devices

**Technical Verification:**
- [ ] No TypeScript errors in frontend or backend
- [ ] No console errors during normal operation
- [ ] All API endpoints return proper error codes
- [ ] Sessions persist across browser restarts (with remember me)
- [ ] Theme persists across sessions
</verification>

<success_criteria>
- Dashboard layout is responsive and adaptive
- Navigation works on desktop (sidebar) and mobile (bottom nav)
- User menu has working logout
- Theme toggle works with all three options
- Settings page has all four sections working
- Verification banner appears for unverified users
- Empty state shows onboarding checklist
- All Phase 1 requirements (AUTH-01 through AUTH-07, DASH-01 through DASH-03) are met
- Human verification checkpoint passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-03-SUMMARY.md` documenting:
- Dashboard structure and components
- Settings features implemented
- Responsive breakpoints and navigation behavior
- Any UX decisions made during implementation
- Known issues or future improvements
- Screenshots or recording links if helpful
</output>
