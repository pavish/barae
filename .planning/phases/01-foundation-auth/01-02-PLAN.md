---
phase: 01-foundation-auth
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - frontend/src/features/auth/components/AuthPage.tsx
  - frontend/src/features/auth/components/LoginForm.tsx
  - frontend/src/features/auth/components/SignupForm.tsx
  - frontend/src/features/auth/components/GithubButton.tsx
  - frontend/src/features/auth/components/ForgotPasswordForm.tsx
  - frontend/src/features/auth/components/ResetPasswordForm.tsx
  - frontend/src/features/auth/pages/AuthPage.tsx
  - frontend/src/features/auth/pages/ForgotPasswordPage.tsx
  - frontend/src/features/auth/pages/ResetPasswordPage.tsx
  - frontend/src/routes/index.tsx
  - frontend/src/shared/components/Input.tsx
  - frontend/src/shared/components/Button.tsx
  - frontend/package.json
  - backend/src/auth/index.ts
  - backend/src/lib/email.ts
  - backend/package.json
autonomous: true
user_setup:
  - service: resend
    why: "Email sending for verification and password reset"
    env_vars:
      - name: RESEND_API_KEY
        source: "Resend Dashboard -> API Keys -> Create API Key"
      - name: EMAIL_FROM
        source: "Your verified domain email, e.g., noreply@yourdomain.com (or use Resend's onboarding domain for testing)"
    dashboard_config:
      - task: "Create Resend account and verify domain (or use onboarding domain)"
        location: "https://resend.com/signup"

must_haves:
  truths:
    - "User can sign up with email and password"
    - "User can log in with email and password"
    - "User can log in with GitHub OAuth"
    - "User can request password reset email"
    - "User receives verification email after signup"
    - "Invalid credentials show appropriate error message"
  artifacts:
    - path: "frontend/src/features/auth/pages/AuthPage.tsx"
      provides: "Combined login/signup page with tabs"
      contains: "LoginForm"
    - path: "frontend/src/features/auth/components/LoginForm.tsx"
      provides: "Email/password login form"
      contains: "signIn.email"
    - path: "frontend/src/features/auth/components/SignupForm.tsx"
      provides: "Registration form with password confirmation"
      contains: "signUp.email"
    - path: "frontend/src/features/auth/components/GithubButton.tsx"
      provides: "GitHub OAuth button"
      contains: "signIn.social"
    - path: "backend/src/lib/email.ts"
      provides: "Resend email service"
      contains: "Resend"
  key_links:
    - from: "frontend/src/features/auth/components/LoginForm.tsx"
      to: "/api/auth/sign-in/email"
      via: "better-auth signIn.email"
      pattern: "signIn\\.email"
    - from: "frontend/src/features/auth/components/SignupForm.tsx"
      to: "/api/auth/sign-up/email"
      via: "better-auth signUp.email"
      pattern: "signUp\\.email"
    - from: "backend/src/auth/index.ts"
      to: "backend/src/lib/email.ts"
      via: "sendVerificationEmail callback"
      pattern: "sendVerificationEmail"
---

<objective>
Build the complete authentication UI and integrate email sending for verification and password reset

Purpose: Enable users to create accounts, log in with email/password or GitHub, and recover forgotten passwords. This is the user-facing auth experience that sits on top of Plan 01's backend infrastructure.

Output: Functional login/signup page with GitHub OAuth, password reset flow, email verification sending, and proper error handling
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-CONTEXT.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
@.planning/phases/01-foundation-auth/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared UI components and install form libraries</name>
  <files>
    frontend/package.json
    frontend/src/shared/components/Input.tsx
    frontend/src/shared/components/Button.tsx
    frontend/src/shared/components/Card.tsx
    frontend/src/shared/components/index.ts
  </files>
  <action>
1. Install form handling libraries:
   ```bash
   cd frontend && npm install react-hook-form @hookform/resolvers zod
   ```

2. Create `frontend/src/shared/components/Button.tsx`:
   - Accept variant prop: 'primary' | 'secondary' | 'outline' | 'ghost' | 'danger'
   - Accept size prop: 'sm' | 'md' | 'lg'
   - Support disabled and loading states
   - Use Tailwind classes with dark mode support
   - Forward ref and accept all button props

3. Create `frontend/src/shared/components/Input.tsx`:
   - Accept label prop (optional)
   - Accept error prop for validation messages
   - Support password visibility toggle for type="password"
   - Use Tailwind classes with dark mode support
   - Forward ref for react-hook-form integration
   - Include focus ring and error border states

4. Create `frontend/src/shared/components/Card.tsx`:
   - Simple container with background, border, shadow
   - Dark mode styling
   - Accept className for composition

5. Create `frontend/src/shared/components/index.ts`:
   - Re-export all shared components

Style guidelines (from CONTEXT.md):
- Dark mode is the default focus
- Use Tailwind's dark: prefix for light mode overrides
- Keep components minimal and composable
  </action>
  <verify>
    Import components in App.tsx temporarily and render them to verify styling works.
    Check both light and dark mode appearances.
    Remove test renders after verification.
  </verify>
  <done>
    Button, Input, and Card components exist with proper Tailwind styling. Components support dark mode. react-hook-form and zod are installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build authentication forms and pages</name>
  <files>
    frontend/src/features/auth/components/LoginForm.tsx
    frontend/src/features/auth/components/SignupForm.tsx
    frontend/src/features/auth/components/GithubButton.tsx
    frontend/src/features/auth/components/ForgotPasswordForm.tsx
    frontend/src/features/auth/components/ResetPasswordForm.tsx
    frontend/src/features/auth/pages/AuthPage.tsx
    frontend/src/features/auth/pages/ForgotPasswordPage.tsx
    frontend/src/features/auth/pages/ResetPasswordPage.tsx
    frontend/src/features/auth/schemas/auth.ts
    frontend/src/routes/index.tsx
  </files>
  <action>
1. Create Zod schemas in `frontend/src/features/auth/schemas/auth.ts`:
   ```typescript
   // loginSchema: email (valid email), password (min 8 chars), rememberMe (boolean, default true)
   // signupSchema: name (min 2 chars), email, password (min 8), confirmPassword - with refine for password match
   // forgotPasswordSchema: email
   // resetPasswordSchema: password, confirmPassword - with refine
   ```

2. Create `frontend/src/features/auth/components/LoginForm.tsx`:
   - Use react-hook-form with zodResolver
   - Fields: email, password, rememberMe checkbox
   - Call authClient.signIn.email on submit
   - Handle errors: display field-level errors, show API errors (USER_NOT_FOUND, INVALID_PASSWORD)
   - Include "Forgot password?" link to /auth/forgot-password
   - Show loading state during submission
   - On success, redirect to /dashboard (router will handle, or use navigate)

3. Create `frontend/src/features/auth/components/SignupForm.tsx`:
   - Use react-hook-form with zodResolver
   - Fields: name, email, password, confirmPassword
   - Call authClient.signUp.email on submit
   - Handle errors: USER_ALREADY_EXISTS shows on email field
   - On success, redirect to /dashboard (user enters immediately, non-blocking verification)

4. Create `frontend/src/features/auth/components/GithubButton.tsx`:
   - Call authClient.signIn.social({ provider: 'github', callbackURL: '/dashboard' })
   - Show GitHub icon (can use simple SVG inline or emoji placeholder initially)
   - Style as secondary/outline button
   - Handle loading state

5. Create `frontend/src/features/auth/pages/AuthPage.tsx`:
   - Two-column layout on desktop (md+): left side form, right side OAuth
   - Stacked on mobile: OAuth first, then form below (or tabs)
   - Tab toggle: "Login" | "Sign Up" - switches between LoginForm and SignupForm
   - Active tab styled differently
   - Include Barae logo at top
   - Dark background with card for forms

6. Create `frontend/src/features/auth/components/ForgotPasswordForm.tsx`:
   - Single email field
   - Call authClient.forgetPassword({ email, redirectTo: '/auth/reset-password' })
   - Show success message: "If an account exists, you'll receive a reset link"
   - Back link to /auth

7. Create `frontend/src/features/auth/pages/ForgotPasswordPage.tsx`:
   - Simple centered card with ForgotPasswordForm
   - Same visual style as AuthPage

8. Create `frontend/src/features/auth/components/ResetPasswordForm.tsx`:
   - Get token from URL search params
   - Fields: newPassword, confirmPassword
   - Call authClient.resetPassword({ token, newPassword })
   - On success, show message and redirect to /auth
   - On error (invalid/expired token), show error with link to request new reset

9. Create `frontend/src/features/auth/pages/ResetPasswordPage.tsx`:
   - Simple centered card with ResetPasswordForm
   - Extract token from URL

10. Update `frontend/src/routes/index.tsx`:
    - Add routes:
      - /auth -> AuthPage
      - /auth/forgot-password -> ForgotPasswordPage
      - /auth/reset-password -> ResetPasswordPage
    - Keep /dashboard and /settings as protected placeholders

Layout decisions (from CONTEXT.md):
- Combined auth page with Login | Sign Up tabs
- Two-column on desktop, stacked on mobile
- Email/password on one side, GitHub OAuth on other
- Validation on frontend with meaningful error display
  </action>
  <verify>
    1. Navigate to http://localhost:5173/auth
    2. See login form with email, password, remember me
    3. Click "Sign Up" tab - form switches to signup with name, confirm password
    4. See GitHub button in the OAuth section
    5. Submit empty form - validation errors appear inline
    6. Check responsive layout - resize window to see mobile layout
  </verify>
  <done>
    AuthPage renders with Login/Signup tabs. Forms validate with Zod. GitHub OAuth button exists. ForgotPassword and ResetPassword pages exist. All routes are configured. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Configure Resend email sending in backend</name>
  <files>
    backend/src/lib/email.ts
    backend/src/auth/index.ts
    backend/src/config.ts
    backend/package.json
    backend/.env.example
  </files>
  <action>
1. Resend should already be installed from Plan 01. If not:
   ```bash
   cd backend && npm install resend
   ```

2. Create `backend/src/lib/email.ts`:
   ```typescript
   import { Resend } from 'resend'

   const resend = new Resend(process.env.RESEND_API_KEY)

   export async function sendVerificationEmail(email: string, url: string) {
     // Don't await - fire and forget to prevent timing attacks
     resend.emails.send({
       from: process.env.EMAIL_FROM || 'Barae <noreply@resend.dev>',
       to: email,
       subject: 'Verify your Barae account',
       html: `
         <h1>Welcome to Barae!</h1>
         <p>Click the link below to verify your email address:</p>
         <a href="${url}">Verify Email</a>
         <p>This link expires in 24 hours.</p>
         <p>If you didn't create an account, you can ignore this email.</p>
       `,
     }).catch(err => {
       console.error('Failed to send verification email:', err)
     })
   }

   export async function sendPasswordResetEmail(email: string, url: string) {
     // Don't await - fire and forget
     resend.emails.send({
       from: process.env.EMAIL_FROM || 'Barae <noreply@resend.dev>',
       to: email,
       subject: 'Reset your Barae password',
       html: `
         <h1>Password Reset</h1>
         <p>Click the link below to reset your password:</p>
         <a href="${url}">Reset Password</a>
         <p>This link expires in 1 hour.</p>
         <p>If you didn't request this, you can ignore this email.</p>
       `,
     }).catch(err => {
       console.error('Failed to send password reset email:', err)
     })
   }
   ```

3. Update `backend/src/auth/index.ts` to use real email functions:
   - Import sendVerificationEmail and sendPasswordResetEmail from lib/email
   - Replace placeholder console.log calls with actual function calls
   - Remember: don't await the email sends (fire and forget)

4. Update `backend/src/config.ts` to include new env vars in schema:
   - RESEND_API_KEY (string, optional for local dev without email)
   - EMAIL_FROM (string, optional, default to Resend's dev domain)

5. Update `backend/.env.example`:
   ```
   RESEND_API_KEY=re_xxxxx
   EMAIL_FROM=Barae <noreply@yourdomain.com>
   ```

6. Add error handling - if RESEND_API_KEY is not set:
   - Log warning on startup
   - Email functions should log to console instead of failing
   - This allows local development without Resend account

Testing note: Without valid Resend credentials, emails won't send but the flow should still work (user can sign up, just won't receive email). Verification link URL will be logged to console for manual testing.
  </action>
  <verify>
    1. Start backend with RESEND_API_KEY not set - should start with warning
    2. Sign up via frontend - should succeed, verification email logged to console
    3. If RESEND_API_KEY is set with test key, email should be sent
    4. Request password reset - same behavior (logged or sent)
  </verify>
  <done>
    Email service module exists. better-auth configured to use real email functions. Emails send via Resend when API key is configured. Graceful fallback to console logging when no API key.
  </done>
</task>

</tasks>

<verification>
After all tasks complete, test full auth flows:

1. **Signup flow:**
   - Go to http://localhost:5173/auth
   - Click "Sign Up" tab
   - Fill form with valid data, submit
   - Should redirect to /dashboard (or placeholder)
   - Check backend logs for verification email (if no Resend key) or check email

2. **Login flow:**
   - Go to http://localhost:5173/auth
   - Enter credentials from signup
   - Submit - should redirect to dashboard
   - Refresh page - should still be logged in (session persists)

3. **GitHub OAuth:**
   - Click GitHub button
   - Should redirect to GitHub auth
   - After auth, should redirect back to /dashboard
   - (Requires GITHUB_CLIENT_ID/SECRET to be configured)

4. **Password reset:**
   - Go to /auth/forgot-password
   - Enter email, submit
   - Check for reset email (logs or actual email)
   - Visit reset link, enter new password
   - Login with new password should work

5. **Validation:**
   - Submit empty login form - should show validation errors
   - Submit signup with mismatched passwords - should show error
   - Submit signup with existing email - should show "Email already registered"
</verification>

<success_criteria>
- AuthPage renders with Login/Signup tabs and GitHub OAuth section
- Forms validate input with clear error messages
- Successful signup creates user and redirects to dashboard
- Successful login creates session and redirects to dashboard
- GitHub OAuth initiates OAuth flow (with valid credentials)
- Password reset flow works end-to-end
- Emails send via Resend (or log to console as fallback)
- Session persists across page refreshes
- No TypeScript errors, no console errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-02-SUMMARY.md` documenting:
- Auth flows implemented
- Components created
- Email service configuration
- Any edge cases or decisions made
- Testing notes for manual verification
</output>
