---
phase: 03-dashboard-shell-auth-frontend
plan: 04
type: execute
wave: 3
depends_on: ["03-02", "03-03"]
files_modified:
  - frontend/src/pages/AuthPage.tsx
autonomous: false

must_haves:
  truths:
    - "A visitor can sign up with email/password and complete OTP email verification in the browser"
    - "A returning user can log in with email/password (with GitHub OAuth button visible but disabled)"
    - "A user who forgot their password can request and complete a reset through the browser"
    - "An authenticated user sees a dashboard with navigation layout (Home + Settings)"
    - "Session expiry redirects to auth page with 'Please log in again' message"
    - "Mobile view shows bottom tabs; desktop view shows top navigation"
  artifacts:
    - path: "frontend/src/pages/AuthPage.tsx"
      provides: "Session expired message handling"
  key_links:
    - from: "Session expiry"
      to: "Auth page expired message"
      via: "location.state.expired flag"
      pattern: "expired"
---

<objective>
Wire the session-expired message in the auth page, then verify the complete Phase 3 implementation through manual testing of all auth flows and dashboard navigation.

Purpose: This plan ensures the two parallel Wave 2 plans (auth forms + dashboard shell) integrate correctly, handles the cross-plan expired message, and provides human verification of the full user experience.
Output: Fully integrated and human-verified Phase 3 implementation.
</objective>

<execution_context>
@/Users/pavish/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pavish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/codebase/frontend.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-CONTEXT.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-01-SUMMARY.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-02-SUMMARY.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-03-SUMMARY.md

@frontend/src/pages/AuthPage.tsx
@frontend/src/routes.tsx
@frontend/src/app.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire session-expired message in AuthPage</name>
  <files>frontend/src/pages/AuthPage.tsx</files>
  <action>
Update AuthPage.tsx to handle the session-expired state passed via React Router location state.

Read `useLocation().state?.expired` -- if true, show an Alert (shadcn/ui, variant "default" or a soft warning style, not destructive) at the top of the auth form area with the message: "Your session has expired. Please sign in again."

Clear the expired state after showing it (so it does not persist on navigation within the auth page). Use `window.history.replaceState` to clean the state, or reset a local state flag after first render.

Also ensure the auth store resets to 'login' view when arriving with expired state (the user should see the login form, not whichever view they were last on).

This is a small, targeted change to one file.
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
TypeScript compiles with no errors.

```bash
grep "expired" frontend/src/pages/AuthPage.tsx
```
Expired state handling present.
  </verify>
  <done>AuthPage shows "Your session has expired. Please sign in again." when navigated to with expired state, and resets to login view.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 3: Dashboard Shell & Auth Frontend

- Auth page with tabbed login/signup, split layout (form + brand panel on desktop, form-only on mobile)
- Signup -> inline OTP verification with 6-digit input, cooldown, and lockout
- Forgot password -> enter email -> OTP + new password reset
- Login with inline validation and error handling
- GitHub OAuth button visible but disabled with "Coming soon"
- Responsive dashboard shell with:
  - Desktop: header with logo, horizontal nav (Home/Settings), user avatar dropdown
  - Mobile: compact header with logo + avatar, bottom tab navigation (Home/Settings)
- Home page with getting-started steps (all disabled for Phase 3)
- Settings page with basic account info
- Session polling (5 min) + 401 detection for session expiry
- Sign out from user menu
  </what-built>
  <how-to-verify>
**Pre-requisite:** Start the dev stack: `docker compose -f compose.dev.yml up`

**Auth Flows (test at http://localhost:8100/auth):**

1. **Signup flow:**
   - Click "Sign up" tab
   - Fill in name, email, password (use a test email)
   - Submit -- should transition to OTP verification view
   - Check Mailpit (http://localhost:8100/mailpit or the configured port) for the OTP email
   - Enter the OTP code -- should auto-advance between digits, support paste
   - After successful verification, should redirect to dashboard

2. **Login flow:**
   - Visit /auth (or sign out first)
   - Enter the credentials you just created
   - Submit -- should redirect to dashboard
   - Try invalid credentials -- should see inline error (no toast)

3. **Password reset flow:**
   - On login tab, click "Forgot password?"
   - Enter your email, submit
   - Check Mailpit for the reset OTP
   - Enter OTP + new password + confirm password
   - Submit -- should show success and transition to login

4. **Validation:**
   - Try submitting empty forms -- inline field errors should appear
   - Try invalid email format -- inline error below email field
   - Try short password on signup -- inline error

5. **OTP cooldown/lockout:**
   - On OTP screen, try to resend immediately -- button should be disabled with countdown
   - After 3 wrong OTP attempts -- should show lockout message

**Dashboard (test after successful login):**

6. **Navigation:**
   - Verify Home page shows with getting-started steps
   - Click Settings in nav -- should navigate to settings page
   - Click Home -- should navigate back

7. **Responsive layout:**
   - Desktop: verify header with logo, horizontal nav links, user avatar dropdown
   - Resize to mobile width: verify bottom tabs appear, top nav disappears, header simplifies
   - Verify content is usable and not cut off on mobile

8. **User menu:**
   - Click avatar -- dropdown should show name/email, Settings link, Sign out
   - Click Sign out -- should redirect to /auth

9. **Route guards:**
   - While logged out, visit http://localhost:8100/ -- should redirect to /auth
   - While logged in, visit http://localhost:8100/auth -- should redirect to /

10. **GitHub OAuth button:**
    - Verify the button is visible on both login and signup tabs
    - Verify it is disabled with "Coming soon" indicator

**Visual quality:**
- Forms are clean and well-spaced
- Split layout looks good on desktop (form + brand panel)
- Mobile view is usable and not cramped
- Loading states (spinners) appear during auth checks
  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` -- zero errors
2. All 4 Phase 3 success criteria verified by human testing:
   - Signup + OTP verification works end-to-end
   - Login works with proper error handling
   - Password reset works end-to-end
   - Dashboard shell renders with responsive navigation
</verification>

<success_criteria>
- Session-expired message shows correctly on auth page
- Human has verified all auth flows work end-to-end in the browser
- Human has verified responsive dashboard layout on desktop and mobile
- Human has verified route guards (redirect behavior)
- All Phase 3 success criteria from ROADMAP.md are met
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-shell-auth-frontend/03-04-SUMMARY.md`
</output>
