---
phase: 03-dashboard-shell-auth-frontend
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ui/* (shadcn CLI output)
  - frontend/src/lib/schemas/auth.ts
  - frontend/src/stores/authStore.ts
  - frontend/src/components/layout/AuthLayout.tsx
  - frontend/src/components/layout/DashboardLayout.tsx
  - frontend/src/components/layout/FullScreenLoader.tsx
  - frontend/src/routes.tsx
  - frontend/src/app.tsx
  - frontend/src/lib/api.ts
  - frontend/src/lib/auth.ts
  - frontend/src/pages/AuthPage.tsx
  - frontend/src/pages/HomePage.tsx
  - frontend/src/pages/SettingsPage.tsx
autonomous: true

must_haves:
  truths:
    - "shadcn/ui components (button, input, field, tabs, input-otp, card, separator, alert, avatar, dropdown-menu, badge) are installed and importable"
    - "React Router is configured with /auth route (guarded by AuthLayout) and / + /settings routes (guarded by DashboardLayout)"
    - "Unauthenticated users accessing dashboard routes are redirected to /auth"
    - "Authenticated users visiting /auth are redirected to /"
    - "Full-screen loader shows while auth state is being determined (no blank flash)"
    - "apiFetch returns 401 errors as a custom auth:expired event"
    - "Auth session type is exported from lib/auth.ts"
  artifacts:
    - path: "frontend/src/components/ui/button.tsx"
      provides: "shadcn/ui Button component"
    - path: "frontend/src/lib/schemas/auth.ts"
      provides: "Zod validation schemas for login, signup, forgot-password, reset-password"
    - path: "frontend/src/stores/authStore.ts"
      provides: "Zustand store managing auth view state machine"
    - path: "frontend/src/routes.tsx"
      provides: "React Router configuration with auth-guarded layouts"
    - path: "frontend/src/components/layout/FullScreenLoader.tsx"
      provides: "Full-screen loading spinner for auth state resolution"
  key_links:
    - from: "frontend/src/routes.tsx"
      to: "authClient.useSession()"
      via: "AuthLayout and DashboardLayout check session"
      pattern: "authClient\\.useSession"
    - from: "frontend/src/app.tsx"
      to: "frontend/src/routes.tsx"
      via: "RouterProvider rendering the router"
      pattern: "RouterProvider"
    - from: "frontend/src/lib/api.ts"
      to: "auth:expired event"
      via: "401 response detection dispatches custom event"
      pattern: "auth:expired"
---

<objective>
Set up the frontend routing infrastructure, install all required shadcn/ui components, create Zod validation schemas, Zustand auth store, route guards, and the app shell with RouterProvider.

Purpose: This plan establishes the foundation that all other Phase 3 plans build on -- routing with auth guards, UI component library, form schemas, and state management.
Output: Working React Router setup with protected routes, placeholder pages, and all shadcn/ui components ready for use.
</objective>

<execution_context>
@/Users/pavish/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pavish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/frontend.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-RESEARCH.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-CONTEXT.md

@frontend/src/app.tsx
@frontend/src/main.tsx
@frontend/src/lib/api.ts
@frontend/src/lib/auth.ts
@frontend/src/lib/queryClient.ts
@frontend/src/lib/utils.ts
@frontend/src/index.css
@frontend/package.json
@frontend/components.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui components</name>
  <files>frontend/src/components/ui/* (CLI-generated)</files>
  <action>
Run the shadcn CLI from the `frontend/` directory to install all required components:

```bash
cd frontend
npx shadcn@latest add button input field tabs input-otp card separator alert avatar dropdown-menu badge
```

This will create component files in `frontend/src/components/ui/` and may install the `input-otp` dependency. Accept all defaults.

After installation, verify the components are importable by checking that the files exist in `frontend/src/components/ui/`.

Do NOT modify any of the generated shadcn/ui component files -- they are used as-is.
  </action>
  <verify>
```bash
ls frontend/src/components/ui/
```
Confirm all component files exist: button.tsx, input.tsx, field.tsx, tabs.tsx, input-otp.tsx, card.tsx, separator.tsx, alert.tsx, avatar.tsx, dropdown-menu.tsx, badge.tsx.

```bash
cd frontend && npx tsc --noEmit
```
TypeScript compiles with no errors.
  </verify>
  <done>All 11 shadcn/ui components are installed in frontend/src/components/ui/ and importable without TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Create foundation files (schemas, store, routes, layouts, app integration)</name>
  <files>
    frontend/src/lib/schemas/auth.ts
    frontend/src/stores/authStore.ts
    frontend/src/components/layout/AuthLayout.tsx
    frontend/src/components/layout/DashboardLayout.tsx
    frontend/src/components/layout/FullScreenLoader.tsx
    frontend/src/routes.tsx
    frontend/src/app.tsx
    frontend/src/lib/api.ts
    frontend/src/lib/auth.ts
    frontend/src/pages/AuthPage.tsx
    frontend/src/pages/HomePage.tsx
    frontend/src/pages/SettingsPage.tsx
  </files>
  <action>
**Create `frontend/src/lib/schemas/auth.ts`** -- Zod validation schemas for all auth forms:

```typescript
import { z } from 'zod'

export const loginSchema = z.object({
  email: z.string().email('Please enter a valid email address'),
  password: z.string().min(1, 'Password is required'),
})

export const signupSchema = z.object({
  name: z.string().min(1, 'Name is required').max(100, 'Name is too long'),
  email: z.string().email('Please enter a valid email address'),
  password: z.string()
    .min(8, 'Password must be at least 8 characters')
    .max(128, 'Password must be at most 128 characters'),
})

export const forgotPasswordSchema = z.object({
  email: z.string().email('Please enter a valid email address'),
})

export const resetPasswordSchema = z.object({
  password: z.string()
    .min(8, 'Password must be at least 8 characters')
    .max(128, 'Password must be at most 128 characters'),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: 'Passwords do not match',
  path: ['confirmPassword'],
})

export type LoginFormData = z.infer<typeof loginSchema>
export type SignupFormData = z.infer<typeof signupSchema>
export type ForgotPasswordFormData = z.infer<typeof forgotPasswordSchema>
export type ResetPasswordFormData = z.infer<typeof resetPasswordSchema>
```

**Create `frontend/src/stores/authStore.ts`** -- Zustand store for auth page view state machine:

```typescript
import { create } from 'zustand'

export type AuthView = 'login' | 'signup' | 'verify-otp' | 'forgot-password' | 'reset-password'

interface AuthStore {
  view: AuthView
  email: string
  setView: (view: AuthView) => void
  setEmail: (email: string) => void
  setViewWithEmail: (view: AuthView, email: string) => void
  reset: () => void
}

export const useAuthStore = create<AuthStore>((set) => ({
  view: 'login',
  email: '',
  setView: (view) => set({ view }),
  setEmail: (email) => set({ email }),
  setViewWithEmail: (view, email) => set({ view, email }),
  reset: () => set({ view: 'login', email: '' }),
}))
```

**Create `frontend/src/components/layout/FullScreenLoader.tsx`** -- Loading spinner shown while auth state resolves:

```typescript
import { Loader2 } from 'lucide-react'

export function FullScreenLoader() {
  return (
    <div className="fixed inset-0 flex items-center justify-center bg-background">
      <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
    </div>
  )
}
```

**Create `frontend/src/components/layout/AuthLayout.tsx`** -- Route guard that redirects authenticated users away from /auth:

```typescript
import { Navigate, Outlet } from 'react-router-dom'
import { authClient } from '@/lib/auth'
import { FullScreenLoader } from '@/components/layout/FullScreenLoader'

export function AuthLayout() {
  const { data: session, isPending } = authClient.useSession()

  if (isPending) return <FullScreenLoader />
  if (session) return <Navigate to="/" replace />

  return <Outlet />
}
```

**Create `frontend/src/components/layout/DashboardLayout.tsx`** -- Route guard that redirects unauthenticated users to /auth with return-to location:

```typescript
import { Navigate, Outlet, useLocation } from 'react-router-dom'
import { authClient } from '@/lib/auth'
import { FullScreenLoader } from '@/components/layout/FullScreenLoader'

export function DashboardLayout() {
  const { data: session, isPending } = authClient.useSession()
  const location = useLocation()

  if (isPending) return <FullScreenLoader />
  if (!session) return <Navigate to="/auth" state={{ from: location }} replace />

  return <Outlet />
}
```

Note: DashboardLayout does NOT include the dashboard shell (header, nav) yet -- that is built in Plan 03 and will wrap the Outlet here.

**Create placeholder pages** -- These are minimal stubs replaced by Plan 02 and Plan 03:

`frontend/src/pages/AuthPage.tsx`:
```typescript
export function AuthPage() {
  return <div>Auth page placeholder</div>
}
```

`frontend/src/pages/HomePage.tsx`:
```typescript
export function HomePage() {
  return <div>Home page placeholder</div>
}
```

`frontend/src/pages/SettingsPage.tsx`:
```typescript
export function SettingsPage() {
  return <div>Settings page placeholder</div>
}
```

**Create `frontend/src/routes.tsx`** -- React Router configuration with auth-guarded layouts:

```typescript
import { createBrowserRouter, Navigate } from 'react-router-dom'
import { AuthLayout } from '@/components/layout/AuthLayout'
import { DashboardLayout } from '@/components/layout/DashboardLayout'
import { AuthPage } from '@/pages/AuthPage'
import { HomePage } from '@/pages/HomePage'
import { SettingsPage } from '@/pages/SettingsPage'

export const router = createBrowserRouter([
  {
    element: <AuthLayout />,
    children: [
      { path: '/auth', element: <AuthPage /> },
    ],
  },
  {
    element: <DashboardLayout />,
    children: [
      { path: '/', element: <HomePage /> },
      { path: '/settings', element: <SettingsPage /> },
    ],
  },
  { path: '*', element: <Navigate to="/" replace /> },
])
```

**Update `frontend/src/app.tsx`** -- Replace placeholder content with RouterProvider:

```typescript
import { QueryClientProvider } from '@tanstack/react-query'
import { RouterProvider } from 'react-router-dom'
import { queryClient } from '@/lib/queryClient'
import { router } from '@/routes'

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <RouterProvider router={router} />
    </QueryClientProvider>
  )
}
```

**Update `frontend/src/lib/api.ts`** -- Add 401 detection that dispatches a custom event for session expiry:

```typescript
const API_BASE = '/api'

export async function apiFetch<T>(
  path: string,
  options?: RequestInit,
): Promise<T> {
  const response = await fetch(`${API_BASE}${path}`, {
    headers: {
      'Content-Type': 'application/json',
      ...options?.headers,
    },
    credentials: 'include',
    ...options,
  })

  if (response.status === 401) {
    window.dispatchEvent(new CustomEvent('auth:expired'))
    throw new Error('Session expired')
  }

  if (!response.ok) {
    const error = await response
      .json()
      .catch(() => ({ message: response.statusText }))
    throw new Error(
      (error as { message?: string }).message ??
        `API error: ${response.status}`,
    )
  }

  return response.json() as Promise<T>
}
```

**Update `frontend/src/lib/auth.ts`** -- Add Session type export:

```typescript
import { createAuthClient } from 'better-auth/react'
import { emailOTPClient } from 'better-auth/client/plugins'

export const authClient = createAuthClient({
  baseURL: '/api/v1',
  plugins: [emailOTPClient()],
})

export type Session = typeof authClient.$Infer.Session
```

Delete the `.gitkeep` files in `pages/`, `hooks/`, `stores/`, and `types/` directories since they now have real content or will in subsequent plans.
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
TypeScript compiles with no errors.

Verify file existence:
```bash
ls frontend/src/lib/schemas/auth.ts
ls frontend/src/stores/authStore.ts
ls frontend/src/components/layout/AuthLayout.tsx
ls frontend/src/components/layout/DashboardLayout.tsx
ls frontend/src/components/layout/FullScreenLoader.tsx
ls frontend/src/routes.tsx
ls frontend/src/pages/AuthPage.tsx
ls frontend/src/pages/HomePage.tsx
ls frontend/src/pages/SettingsPage.tsx
```
All files exist.

Check imports resolve:
```bash
cd frontend && npx tsc --noEmit 2>&1 | head -20
```
No import resolution errors.
  </verify>
  <done>
    - Zod schemas exported for login, signup, forgot-password, reset-password forms
    - Zustand auth store manages view state machine (login, signup, verify-otp, forgot-password, reset-password) and preserves email across transitions
    - AuthLayout redirects authenticated users away from /auth; DashboardLayout redirects unauthenticated users to /auth with return-to location
    - FullScreenLoader shown during auth state resolution (no blank flash)
    - routes.tsx defines /auth (guarded), / and /settings (guarded) with catch-all redirect
    - app.tsx uses RouterProvider (no more placeholder content)
    - apiFetch dispatches auth:expired custom event on 401 responses
    - Session type exported from lib/auth.ts
    - All files compile without TypeScript errors
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` -- zero errors
2. shadcn/ui components exist in `frontend/src/components/ui/` (button, input, field, tabs, input-otp, card, separator, alert, avatar, dropdown-menu, badge)
3. `frontend/src/routes.tsx` defines routes with AuthLayout and DashboardLayout guards
4. `frontend/src/app.tsx` renders RouterProvider
5. `frontend/src/lib/api.ts` contains 401 detection with auth:expired event
6. `frontend/src/stores/authStore.ts` exports useAuthStore with view state machine
7. `frontend/src/lib/schemas/auth.ts` exports 4 Zod schemas + 4 inferred types
</verification>

<success_criteria>
- All shadcn/ui components installed and TypeScript-clean
- React Router configured with /auth and / + /settings routes behind auth guards
- Auth state machine store ready for auth page views
- Zod schemas ready for form validation
- App renders via RouterProvider
- 401 detection wired in apiFetch
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-shell-auth-frontend/03-01-SUMMARY.md`
</output>
