---
phase: 03-dashboard-shell-auth-frontend
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - frontend/src/components/layout/DashboardLayout.tsx
  - frontend/src/components/layout/DashboardShell.tsx
  - frontend/src/components/layout/Header.tsx
  - frontend/src/components/layout/TopNav.tsx
  - frontend/src/components/layout/BottomTabs.tsx
  - frontend/src/components/layout/UserMenu.tsx
  - frontend/src/pages/HomePage.tsx
  - frontend/src/pages/SettingsPage.tsx
  - frontend/src/hooks/useSessionPolling.ts
  - frontend/src/hooks/useAuthExpiry.ts
autonomous: true

must_haves:
  truths:
    - "Authenticated user sees a responsive dashboard with header bar and navigation"
    - "Desktop shows top horizontal navigation with Home and Settings links; mobile shows bottom tab navigation"
    - "Header shows the Barae logo and a user avatar dropdown with name/email, Settings link, and Sign out"
    - "Home page shows a getting-started layout with placeholder steps and CTAs"
    - "Settings page shows a basic placeholder ready for future feature content"
    - "Session polling checks every 5 minutes; expired sessions redirect to /auth with a message"
    - "401 responses from apiFetch also trigger redirect to /auth with session expired message"
    - "Sign out from user menu clears session and redirects to /auth"
  artifacts:
    - path: "frontend/src/components/layout/DashboardShell.tsx"
      provides: "Responsive dashboard wrapper with header, main content area, and bottom tabs"
    - path: "frontend/src/components/layout/Header.tsx"
      provides: "Dashboard header with logo, desktop nav, user menu"
    - path: "frontend/src/components/layout/BottomTabs.tsx"
      provides: "Mobile bottom tab navigation"
    - path: "frontend/src/components/layout/UserMenu.tsx"
      provides: "Avatar dropdown with user info and sign out"
    - path: "frontend/src/pages/HomePage.tsx"
      provides: "Getting-started home page with CTA cards"
    - path: "frontend/src/hooks/useSessionPolling.ts"
      provides: "Proactive session expiry detection via polling"
    - path: "frontend/src/hooks/useAuthExpiry.ts"
      provides: "Listener for auth:expired events from apiFetch"
  key_links:
    - from: "frontend/src/components/layout/DashboardShell.tsx"
      to: "frontend/src/components/layout/Header.tsx"
      via: "renders Header at top of shell"
      pattern: "<Header"
    - from: "frontend/src/components/layout/DashboardShell.tsx"
      to: "frontend/src/components/layout/BottomTabs.tsx"
      via: "renders BottomTabs at bottom on mobile"
      pattern: "<BottomTabs"
    - from: "frontend/src/hooks/useSessionPolling.ts"
      to: "authClient.getSession()"
      via: "periodic session check"
      pattern: "authClient\\.getSession"
    - from: "frontend/src/components/layout/UserMenu.tsx"
      to: "authClient.signOut()"
      via: "sign out button handler"
      pattern: "authClient\\.signOut"
    - from: "frontend/src/components/layout/DashboardLayout.tsx"
      to: "frontend/src/components/layout/DashboardShell.tsx"
      via: "wraps Outlet in DashboardShell"
      pattern: "<DashboardShell"
---

<objective>
Build the responsive dashboard shell with navigation, user menu, home page, settings page, and session management (polling + 401 detection).

Purpose: This plan creates the authenticated user experience -- the dashboard navigation shell that will house all future features, and the session management that keeps users securely connected.
Output: Working responsive dashboard with header, navigation (top on desktop, bottom tabs on mobile), user menu with sign out, home page with getting-started content, and session expiry handling.
</objective>

<execution_context>
@/Users/pavish/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pavish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/codebase/frontend.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-RESEARCH.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-CONTEXT.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-01-SUMMARY.md

@frontend/src/lib/auth.ts
@frontend/src/stores/authStore.ts
@frontend/src/components/layout/DashboardLayout.tsx
@frontend/src/components/layout/FullScreenLoader.tsx
@frontend/src/routes.tsx
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build DashboardShell, Header, TopNav, BottomTabs, UserMenu</name>
  <files>
    frontend/src/components/layout/DashboardShell.tsx
    frontend/src/components/layout/Header.tsx
    frontend/src/components/layout/TopNav.tsx
    frontend/src/components/layout/BottomTabs.tsx
    frontend/src/components/layout/UserMenu.tsx
    frontend/src/components/layout/DashboardLayout.tsx
  </files>
  <action>
**Create `frontend/src/components/layout/TopNav.tsx`** -- Desktop horizontal navigation:

Navigation items for Phase 3: Home (`/`) and Settings (`/settings`). Use `NavLink` from react-router-dom for active state styling. Render as horizontal links with appropriate spacing. Active link has a distinct style (e.g., `font-medium text-foreground` vs `text-muted-foreground` for inactive).

**Create `frontend/src/components/layout/BottomTabs.tsx`** -- Mobile bottom tab navigation:

Fixed at the bottom of the screen (mobile only, hidden on md+). Two tab items: Home (with Home icon from lucide-react) and Settings (with Settings icon). Use `NavLink` for active state. Each tab is a flex column with icon + label text. Active tab has primary color styling. Safe area padding at the bottom for mobile (e.g., `pb-safe` or extra padding).

**Create `frontend/src/components/layout/UserMenu.tsx`** -- User avatar with dropdown:

Props: receives session data (user name, email).

Renders:
- Avatar component (shadcn/ui Avatar) showing the user's initials (first letter of name, fallback if no avatar image)
- On click: DropdownMenu (shadcn/ui) with:
  - User name and email displayed at the top (non-clickable label)
  - Separator
  - "Settings" menu item (navigates to /settings)
  - "Sign out" menu item (calls `authClient.signOut()`, then navigates to /auth)

Sign out handler: call `await authClient.signOut()`, then `navigate('/auth')`.

**Create `frontend/src/components/layout/Header.tsx`** -- Dashboard header bar:

Renders two header variants (mobile and desktop) in one component using responsive Tailwind classes:

- **Desktop (hidden on mobile, `hidden md:flex`):** Height h-16, border-b, padded. Left: "Barae" text logo (or a simple styled span). Center/left: TopNav component. Right: UserMenu.
- **Mobile (`flex md:hidden`):** Height h-14, border-b, padded. Left: "Barae" text logo (smaller). Right: UserMenu. No navigation links (those are in BottomTabs).

Props: receives session data to pass to UserMenu.

**Create `frontend/src/components/layout/DashboardShell.tsx`** -- Responsive dashboard wrapper:

Structure:
```
<div className="min-h-screen flex flex-col">
  <Header session={session} />
  <main className="flex-1 p-4 md:p-6 pb-20 md:pb-6">
    {children}
  </main>
  <BottomTabs /> {/* mobile only, hidden on md+ */}
</div>
```

The `pb-20` on main ensures content doesn't get hidden behind the fixed bottom tabs on mobile. On desktop (`md:pb-6`), normal padding since there are no bottom tabs.

Props: `children: React.ReactNode`, `session` (from DashboardLayout).

**Update `frontend/src/components/layout/DashboardLayout.tsx`** -- Wrap Outlet in DashboardShell:

The existing DashboardLayout already checks auth state and shows FullScreenLoader. Update it to wrap the Outlet in DashboardShell when session is available:

```typescript
if (!session) return <Navigate to="/auth" state={{ from: location }} replace />

return (
  <DashboardShell session={session}>
    <Outlet />
  </DashboardShell>
)
```

Pass the session data to DashboardShell so it can pass it to Header/UserMenu.

**Design guidelines (locked decisions):**
- Mobile support is top-class priority -- design mobile-first
- Bottom tab navigation on mobile, top horizontal navigation on desktop
- No sidebar. No hamburger menu.
- Navigation sections: Home and Settings only
- Use `cn()` for all conditional class merging
- Use lucide-react icons: `Home`, `Settings`, `LogOut`, `User` (or similar)
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
TypeScript compiles with no errors.

Verify files exist:
```bash
ls frontend/src/components/layout/DashboardShell.tsx
ls frontend/src/components/layout/Header.tsx
ls frontend/src/components/layout/TopNav.tsx
ls frontend/src/components/layout/BottomTabs.tsx
ls frontend/src/components/layout/UserMenu.tsx
```

Grep for key wiring:
```bash
grep -r "authClient.signOut" frontend/src/components/layout/UserMenu.tsx
grep -r "NavLink" frontend/src/components/layout/TopNav.tsx
grep -r "NavLink" frontend/src/components/layout/BottomTabs.tsx
grep -r "DashboardShell" frontend/src/components/layout/DashboardLayout.tsx
grep -r "DropdownMenu" frontend/src/components/layout/UserMenu.tsx
```
All wiring present.
  </verify>
  <done>
    - DashboardShell wraps content with Header + main area + BottomTabs
    - Header shows Barae logo, TopNav on desktop, UserMenu on all sizes
    - TopNav renders Home and Settings links with active state (desktop only)
    - BottomTabs renders Home and Settings tabs with icons (mobile only)
    - UserMenu shows avatar with dropdown: user info, Settings link, Sign out
    - Sign out calls authClient.signOut() and redirects to /auth
    - DashboardLayout wraps Outlet in DashboardShell with session data
    - Mobile-first responsive design
    - TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Build HomePage, SettingsPage, and session management hooks</name>
  <files>
    frontend/src/pages/HomePage.tsx
    frontend/src/pages/SettingsPage.tsx
    frontend/src/hooks/useSessionPolling.ts
    frontend/src/hooks/useAuthExpiry.ts
    frontend/src/components/layout/DashboardShell.tsx
  </files>
  <action>
**Create `frontend/src/hooks/useSessionPolling.ts`** -- Proactive session expiry detection:

Polls `authClient.getSession()` every 5 minutes (300,000ms). If session is expired or error occurs, navigate to `/auth` with state `{ expired: true }`.

```typescript
import { useEffect, useRef } from 'react'
import { useNavigate } from 'react-router-dom'
import { authClient } from '@/lib/auth'

const POLL_INTERVAL = 5 * 60 * 1000 // 5 minutes

export function useSessionPolling() {
  const navigate = useNavigate()
  const intervalRef = useRef<ReturnType<typeof setInterval>>(undefined)

  useEffect(() => {
    intervalRef.current = setInterval(async () => {
      const { data, error } = await authClient.getSession()
      if (error || !data) {
        navigate('/auth', { state: { expired: true } })
      }
    }, POLL_INTERVAL)

    return () => clearInterval(intervalRef.current)
  }, [navigate])
}
```

**Create `frontend/src/hooks/useAuthExpiry.ts`** -- Lazy 401 detection listener:

Listens for the `auth:expired` custom event dispatched by apiFetch (from Plan 01). On event, navigates to `/auth` with state `{ expired: true }`.

```typescript
import { useEffect } from 'react'
import { useNavigate } from 'react-router-dom'

export function useAuthExpiry() {
  const navigate = useNavigate()

  useEffect(() => {
    function handleExpired() {
      navigate('/auth', { state: { expired: true } })
    }

    window.addEventListener('auth:expired', handleExpired)
    return () => window.removeEventListener('auth:expired', handleExpired)
  }, [navigate])
}
```

**Update `frontend/src/components/layout/DashboardShell.tsx`** -- Wire session management hooks:

Add `useSessionPolling()` and `useAuthExpiry()` calls inside DashboardShell so they are active whenever the dashboard is mounted.

**Replace `frontend/src/pages/HomePage.tsx`** -- Getting-started home page:

Design a clean "Getting Started" layout structured to evolve across phases:

- Heading: "Welcome to Barae" with a brief tagline below
- A "Getting Started" section with numbered step cards:
  1. **Connect GitHub** -- "Link your GitHub account to get started" -- Button: "Connect GitHub" (disabled, muted styling, with text "Coming soon" or similar)
  2. **Choose a template** -- "Pick a template for your site" -- (muted/disabled, future step)
  3. **Create your site** -- "Launch your site on GitHub Pages" -- (muted/disabled, future step)

Use Card components (shadcn/ui) for each step. Cards should be in a vertical stack on mobile, possibly a row on larger screens. Steps 1-3 are all in a disabled/muted state since GitHub isn't wired yet. Use muted colors and `opacity-60` or similar to indicate these are not yet actionable.

The layout should be a content area with reasonable max-width (e.g., `max-w-3xl mx-auto`) so it does not stretch across ultra-wide screens.

**Replace `frontend/src/pages/SettingsPage.tsx`** -- Settings placeholder:

Simple page with:
- Heading: "Settings"
- A Card or section with basic account info (read from session): user name, email
- Placeholder sections for future settings (e.g., "GitHub Account" with "Coming soon" text)
- The actual settings functionality (password change, account management) will be added in later phases

This is intentionally minimal -- just enough to show that navigation works and the route renders a meaningful page.

**Session expired message:** When the auth page receives `state.expired = true` (from session polling or 401 detection), it should show a message like "Your session has expired. Please sign in again." at the top of the login form. Handle this in AuthPage.tsx -- read `useLocation().state?.expired` and show an Alert if true. (Note: This is a small update to AuthPage.tsx created in Plan 02. If Plan 02 has already run, update the file. If not, document this as a note in the summary for Plan 02 to pick up. Since Plans 02 and 03 run in the same wave but are independent, handle this by adding the expired message handling in this plan's update to DashboardShell or by creating a small note.)

**Decision:** Since AuthPage.tsx is owned by Plan 02 (same wave), do NOT modify it in this plan. Instead, handle the expired state in `DashboardLayout.tsx` -- when redirecting to /auth due to no session, include `{ expired: true }` only if we came from an expired event. The auth page (Plan 02) will handle reading this state.

Actually, the simpler approach: the hooks already navigate with `{ state: { expired: true } }`. Plan 02's AuthPage can read this state. No cross-plan file conflict needed. Just document in the summary that AuthPage should show expired message when `location.state?.expired` is true.

**Important constraints:**
- Mobile-first design
- Cards for getting-started steps
- All future features shown as disabled/muted (not hidden)
- Session polling at 5-minute intervals
- auth:expired event listener for lazy 401 detection
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
TypeScript compiles with no errors.

Verify files exist:
```bash
ls frontend/src/pages/HomePage.tsx
ls frontend/src/pages/SettingsPage.tsx
ls frontend/src/hooks/useSessionPolling.ts
ls frontend/src/hooks/useAuthExpiry.ts
```

Grep for key wiring:
```bash
grep -r "useSessionPolling" frontend/src/components/layout/DashboardShell.tsx
grep -r "useAuthExpiry" frontend/src/components/layout/DashboardShell.tsx
grep -r "authClient.getSession" frontend/src/hooks/useSessionPolling.ts
grep -r "auth:expired" frontend/src/hooks/useAuthExpiry.ts
```
All wiring present.

Verify HomePage has step structure:
```bash
grep -r "Connect GitHub" frontend/src/pages/HomePage.tsx
grep -r "Choose a template" frontend/src/pages/HomePage.tsx
```
Getting-started steps present.
  </verify>
  <done>
    - Session polling checks every 5 minutes; redirects to /auth with expired state on failure
    - auth:expired event listener catches 401s from apiFetch; redirects to /auth with expired state
    - Both hooks wired in DashboardShell (active while dashboard is mounted)
    - HomePage shows "Welcome to Barae" with 3-step getting-started cards (all disabled/muted for Phase 3)
    - SettingsPage shows heading with basic account info from session and placeholder sections
    - All pages render meaningfully for navigation verification
    - TypeScript compiles cleanly
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` -- zero errors
2. DashboardShell renders Header with logo, TopNav (desktop), BottomTabs (mobile), UserMenu
3. TopNav shows Home and Settings links with active styling
4. BottomTabs shows Home and Settings tabs with icons (mobile only)
5. UserMenu shows avatar dropdown with user info, Settings, and Sign out
6. Sign out calls authClient.signOut() and redirects
7. HomePage renders getting-started steps with disabled CTAs
8. SettingsPage renders with heading and account info placeholder
9. Session polling runs every 5 minutes inside DashboardShell
10. auth:expired events trigger redirect to /auth
</verification>

<success_criteria>
- Responsive dashboard shell with header and navigation
- Desktop: top nav with Home/Settings links; Mobile: bottom tab bar with icons
- User menu with avatar dropdown, sign out functionality
- Home page with getting-started cards structured for evolution
- Settings page with minimal placeholder content
- Session expiry detection via polling (5 min) AND 401 interception
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-shell-auth-frontend/03-03-SUMMARY.md`
</output>
