---
phase: 03-dashboard-shell-auth-frontend
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - frontend/src/pages/AuthPage.tsx
  - frontend/src/components/auth/LoginForm.tsx
  - frontend/src/components/auth/SignupForm.tsx
  - frontend/src/components/auth/OtpVerification.tsx
  - frontend/src/components/auth/ForgotPasswordForm.tsx
  - frontend/src/components/auth/ResetPasswordForm.tsx
  - frontend/src/components/auth/AuthErrorBanner.tsx
  - frontend/src/hooks/useOtpCooldown.ts
autonomous: true

must_haves:
  truths:
    - "Auth page shows tabbed login/signup with split layout (form + illustration on desktop, form-only on mobile)"
    - "User can fill and submit login form with email/password, seeing inline validation errors"
    - "User can fill and submit signup form with name/email/password, transitioning inline to OTP verification on success"
    - "OTP input shows 6 individual digit boxes with auto-advance and paste support"
    - "User can re-request OTP after 1-minute cooldown (countdown visible); locked out for 30 minutes after 3 failed attempts"
    - "User can initiate forgot-password from login tab, enter email to receive OTP, then enter OTP + new password to reset"
    - "GitHub OAuth button is visible but disabled with 'Coming soon' indicator"
    - "Form errors show inline below fields; general errors show in a banner within the form (no toasts)"
  artifacts:
    - path: "frontend/src/pages/AuthPage.tsx"
      provides: "Auth page with split layout, tabs, view state machine rendering"
    - path: "frontend/src/components/auth/LoginForm.tsx"
      provides: "Login form with email/password fields, forgot-password link, GitHub button"
    - path: "frontend/src/components/auth/SignupForm.tsx"
      provides: "Signup form with name/email/password fields, GitHub button"
    - path: "frontend/src/components/auth/OtpVerification.tsx"
      provides: "OTP 6-digit input with cooldown, retry, lockout logic"
    - path: "frontend/src/components/auth/ForgotPasswordForm.tsx"
      provides: "Email input to request password reset OTP"
    - path: "frontend/src/components/auth/ResetPasswordForm.tsx"
      provides: "OTP + new password + confirm password form"
    - path: "frontend/src/hooks/useOtpCooldown.ts"
      provides: "Reusable hook for OTP resend cooldown timer"
  key_links:
    - from: "frontend/src/components/auth/LoginForm.tsx"
      to: "authClient.signIn.email()"
      via: "form onSubmit handler"
      pattern: "authClient\\.signIn\\.email"
    - from: "frontend/src/components/auth/SignupForm.tsx"
      to: "authClient.signUp.email()"
      via: "form onSubmit handler"
      pattern: "authClient\\.signUp\\.email"
    - from: "frontend/src/components/auth/OtpVerification.tsx"
      to: "authClient.emailOtp.verifyEmail()"
      via: "OTP onComplete handler"
      pattern: "authClient\\.emailOtp\\.verifyEmail"
    - from: "frontend/src/components/auth/ResetPasswordForm.tsx"
      to: "authClient.emailOtp.resetPassword()"
      via: "form onSubmit handler"
      pattern: "authClient\\.emailOtp\\.resetPassword"
    - from: "frontend/src/pages/AuthPage.tsx"
      to: "frontend/src/stores/authStore.ts"
      via: "useAuthStore() to determine which view to render"
      pattern: "useAuthStore"
---

<objective>
Build the complete auth page with all form views: tabbed login/signup, inline OTP verification after signup, and inline forgot-password/reset-password flows.

Purpose: This plan implements the browser-side authentication lifecycle -- the user-facing forms that wire to the already-built backend auth API. Users complete signup, email verification, login, and password reset entirely in the browser.
Output: Fully functional auth page with all views, form validation, error handling, and better-auth client integration.
</objective>

<execution_context>
@/Users/pavish/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pavish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/codebase/frontend.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-RESEARCH.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-CONTEXT.md
@.planning/phases/03-dashboard-shell-auth-frontend/03-01-SUMMARY.md

@frontend/src/lib/auth.ts
@frontend/src/lib/schemas/auth.ts
@frontend/src/stores/authStore.ts
@frontend/src/components/layout/AuthLayout.tsx
@frontend/src/routes.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build AuthPage with split layout, LoginForm, and SignupForm</name>
  <files>
    frontend/src/pages/AuthPage.tsx
    frontend/src/components/auth/LoginForm.tsx
    frontend/src/components/auth/SignupForm.tsx
    frontend/src/components/auth/AuthErrorBanner.tsx
  </files>
  <action>
**Create `frontend/src/components/auth/AuthErrorBanner.tsx`** -- Reusable error banner for form-level errors:

A simple wrapper around shadcn/ui Alert with destructive variant. Accepts a `message` prop (string or null). Renders nothing when message is null. Used by all auth forms for general errors (e.g., "Invalid credentials", "Account already exists").

**Create `frontend/src/components/auth/LoginForm.tsx`** -- Login form wired to better-auth:

Uses react-hook-form with zodResolver and the `loginSchema` from `@/lib/schemas/auth`. Fields:
- Email input (type="email")
- Password input (type="password")
- "Forgot password?" text button below the password field that calls `useAuthStore().setView('forgot-password')`
- Submit button ("Sign in") with loading state (disabled + "Signing in..." text while submitting)
- Below the form: a Separator with "or" text, then a GitHub OAuth button (disabled, with Badge "Coming soon")

On submit: call `authClient.signIn.email({ email, password })`. On error, set form-level error in AuthErrorBanner (do NOT use toasts). On success, better-auth's useSession will automatically update and the AuthLayout guard will redirect to dashboard.

Accepts an optional `defaultEmail` prop to pre-fill the email field (used after password reset success).

Use the Controller + Field + FieldLabel + FieldError pattern from the research doc. Inline field validation errors below each field.

**Create `frontend/src/components/auth/SignupForm.tsx`** -- Signup form wired to better-auth:

Uses react-hook-form with zodResolver and the `signupSchema` from `@/lib/schemas/auth`. Fields:
- Name input (type="text")
- Email input (type="email")
- Password input (type="password")
- Submit button ("Create account") with loading state

Below the form: Separator with "or", then disabled GitHub OAuth button with Badge "Coming soon".

On submit: call `authClient.signUp.email({ name, email, password })`. On error, show in AuthErrorBanner. On success, call `useAuthStore().setViewWithEmail('verify-otp', email)` to transition inline to OTP verification (the backend sends the OTP automatically via sendVerificationOnSignUp).

**Create `frontend/src/pages/AuthPage.tsx`** -- Replace the placeholder with the full auth page:

Split layout using `grid grid-cols-1 lg:grid-cols-2 min-h-screen`:
- **Left side (desktop only, hidden on mobile with `hidden lg:flex`):** Brand/illustration panel. Use a gradient background (e.g., subtle primary-to-accent gradient) with the Barae logo/name and a brief tagline like "Your content, your git repo, your control." Keep it simple and clean.
- **Right side (full width on mobile):** Auth form area, vertically centered, with max-width constraint (e.g., `max-w-md mx-auto`).

The right side renders based on `useAuthStore().view`:
- `'login'` or `'signup'`: Render a Card containing Tabs (shadcn/ui Tabs component) with two TabsTrigger items ("Sign in" and "Sign up"). The TabsContent for "Sign in" renders LoginForm; the TabsContent for "Sign up" renders SignupForm. When the auth store view is 'login', set the active tab to "login"; when 'signup', set to "signup". Sync tab changes to the store via `onValueChange`.
- `'verify-otp'`: Render OtpVerification component (built in Task 2)
- `'forgot-password'`: Render ForgotPasswordForm (built in Task 2)
- `'reset-password'`: Render ResetPasswordForm (built in Task 2)

For views not yet built (verify-otp, forgot-password, reset-password), render a temporary "Coming in Task 2" placeholder. This keeps the page functional for verification.

Use `useLocation()` to read the `state.from` from the router (for redirect-back-after-login). After successful login, if `state.from` exists, navigate there; otherwise navigate to `/`.

**Mobile-first design:** The form should look good and be fully usable on mobile (form-only, no illustration). Test mentally: on a 375px-wide screen, the form card should take full width with appropriate padding.

**Important constraints:**
- No toast notifications for errors. Inline field errors + AuthErrorBanner only.
- GitHub OAuth button: disabled state with "Coming soon" Badge. Use `variant="outline"` on the Button, disabled, with a GitHub icon (lucide-react `Github` or similar) and text "Continue with GitHub".
- Use `cn()` for all conditional class merging.
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
TypeScript compiles with no errors.

Verify files exist:
```bash
ls frontend/src/pages/AuthPage.tsx
ls frontend/src/components/auth/LoginForm.tsx
ls frontend/src/components/auth/SignupForm.tsx
ls frontend/src/components/auth/AuthErrorBanner.tsx
```

Grep for key wiring:
```bash
grep -r "authClient.signIn.email" frontend/src/components/auth/
grep -r "authClient.signUp.email" frontend/src/components/auth/
grep -r "useAuthStore" frontend/src/pages/AuthPage.tsx
grep -r "zodResolver" frontend/src/components/auth/
```
All wiring present.
  </verify>
  <done>
    - AuthPage renders split layout (illustration + form on desktop, form-only on mobile)
    - Tabs switch between LoginForm and SignupForm
    - LoginForm wired to authClient.signIn.email with inline validation and error banner
    - SignupForm wired to authClient.signUp.email, transitions to verify-otp view on success
    - GitHub OAuth button visible but disabled with "Coming soon"
    - No toasts used for errors
    - TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Build OTP verification, forgot-password, and reset-password views</name>
  <files>
    frontend/src/components/auth/OtpVerification.tsx
    frontend/src/components/auth/ForgotPasswordForm.tsx
    frontend/src/components/auth/ResetPasswordForm.tsx
    frontend/src/hooks/useOtpCooldown.ts
  </files>
  <action>
**Create `frontend/src/hooks/useOtpCooldown.ts`** -- Reusable hook for OTP resend cooldown:

```typescript
import { useState, useEffect, useCallback } from 'react'

export function useOtpCooldown(cooldownSeconds = 60) {
  const [secondsLeft, setSecondsLeft] = useState(0)

  const startCooldown = useCallback(() => {
    setSecondsLeft(cooldownSeconds)
  }, [cooldownSeconds])

  useEffect(() => {
    if (secondsLeft <= 0) return
    const timer = setTimeout(() => setSecondsLeft((s) => s - 1), 1000)
    return () => clearTimeout(timer)
  }, [secondsLeft])

  return {
    canResend: secondsLeft === 0,
    secondsLeft,
    startCooldown,
  }
}
```

**Create `frontend/src/components/auth/OtpVerification.tsx`** -- OTP verification after signup:

Props: `email: string` (from auth store), `type: 'email-verification' | 'forget-password'` (determines which verification method to call).

Renders:
- Heading: "Check your email" or "Verify your email"
- Subtext: "We sent a verification code to {email}"
- shadcn/ui InputOTP component with 6 slots, REGEXP_ONLY_DIGITS pattern, auto-advance and paste support
- Error message below OTP input (if verification fails)
- "Resend code" button with cooldown timer (uses useOtpCooldown hook)
- "Back to login" text button that calls `useAuthStore().reset()`

**OTP verification logic:**
- On `onComplete` (all 6 digits entered): call `authClient.emailOtp.verifyEmail({ email, otp })` for email-verification type
- On error: show error message, clear OTP input (reset value to empty string)
- On success: the user is automatically signed in (autoSignIn was enabled on signup). The AuthLayout guard will detect the session and redirect to dashboard.

**OTP cooldown logic:**
- Start cooldown immediately on mount (the OTP was already sent during signup via sendVerificationOnSignUp)
- "Resend code" button: calls `authClient.emailOtp.sendVerificationOtp({ email, type: 'email-verification' })`, then starts cooldown

**OTP lockout logic (3 failed attempts -> 30 minutes):**
- Track `failedAttempts` in component state
- On verification failure, increment failedAttempts
- When failedAttempts reaches 3:
  - Store lockout expiry timestamp in `localStorage` key `'barae:otp-lockout'`
  - Show lockout message: "Too many failed attempts. Please try again in {minutes} minutes."
  - Disable the OTP input
- On mount, check localStorage for existing lockout. If lockout hasn't expired, show lockout message with remaining time.
- The lockout timer counts down and auto-clears when expired.

**Create `frontend/src/components/auth/ForgotPasswordForm.tsx`** -- Email input to request password reset OTP:

Uses react-hook-form with zodResolver and `forgotPasswordSchema`. Single field:
- Email input

On submit: call `authClient.emailOtp.requestPasswordReset({ email })`. On error, show in AuthErrorBanner. On success, call `useAuthStore().setViewWithEmail('reset-password', email)` to transition to reset-password view.

Include a "Back to sign in" text button that calls `useAuthStore().setView('login')`.

**Create `frontend/src/components/auth/ResetPasswordForm.tsx`** -- OTP + new password to complete reset:

Renders:
- Heading: "Reset your password"
- Subtext: "Enter the code sent to {email} and your new password"
- OTP input (6-digit, same pattern as OtpVerification)
- New password field (validated against resetPasswordSchema's password rules)
- Confirm password field (validated against resetPasswordSchema)
- Submit button ("Reset password") with loading state

Uses react-hook-form with zodResolver and `resetPasswordSchema` for the password fields. OTP is managed separately in component state (not part of the form schema) since it's a separate InputOTP widget.

On submit: call `authClient.emailOtp.resetPassword({ email, otp, password })`. On error, show in AuthErrorBanner. On success, show a success message ("Password reset successfully") and transition to login view after a brief delay (e.g., 2 seconds), pre-filling the email in the login form.

Include resend OTP button with cooldown (uses useOtpCooldown). Resend calls `authClient.emailOtp.sendVerificationOtp({ email, type: 'forget-password' })`.

Include a "Back to sign in" text button.

**Update `frontend/src/pages/AuthPage.tsx`** -- Replace the Task 2 placeholders with real components:
- `'verify-otp'` -> render `<OtpVerification email={email} type="email-verification" />`
- `'forgot-password'` -> render `<ForgotPasswordForm />`
- `'reset-password'` -> render `<ResetPasswordForm email={email} />`

Where `email` comes from `useAuthStore().email`.

**Important constraints:**
- OTP input: individual digit boxes (6 digits), auto-advance focus, must support paste
- No toasts -- all errors inline
- 1-minute cooldown on resend, 30-minute lockout after 3 failures (client-side with localStorage)
- Use the correct better-auth emailOTP methods (NOT the link-based forgetPassword)
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
TypeScript compiles with no errors.

Verify files exist:
```bash
ls frontend/src/components/auth/OtpVerification.tsx
ls frontend/src/components/auth/ForgotPasswordForm.tsx
ls frontend/src/components/auth/ResetPasswordForm.tsx
ls frontend/src/hooks/useOtpCooldown.ts
```

Grep for key wiring:
```bash
grep -r "authClient.emailOtp.verifyEmail" frontend/src/components/auth/
grep -r "authClient.emailOtp.requestPasswordReset" frontend/src/components/auth/
grep -r "authClient.emailOtp.resetPassword" frontend/src/components/auth/
grep -r "authClient.emailOtp.sendVerificationOtp" frontend/src/components/auth/
grep -r "useOtpCooldown" frontend/src/components/auth/
grep -r "REGEXP_ONLY_DIGITS" frontend/src/components/auth/
grep -r "otp-lockout" frontend/src/components/auth/
```
All wiring present.
  </verify>
  <done>
    - OtpVerification renders 6-digit InputOTP with auto-advance and paste, wired to authClient.emailOtp.verifyEmail
    - OTP resend with 1-minute cooldown timer (useOtpCooldown hook)
    - 30-minute lockout after 3 failed OTP attempts (persisted in localStorage)
    - ForgotPasswordForm accepts email and requests password reset OTP
    - ResetPasswordForm accepts OTP + new password + confirm, wired to authClient.emailOtp.resetPassword
    - AuthPage renders all views based on auth store state (no more placeholders)
    - All correct better-auth emailOTP methods used (not link-based)
    - No toasts -- inline errors only
    - TypeScript compiles cleanly
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` -- zero errors
2. AuthPage renders correctly for all 5 view states (login, signup, verify-otp, forgot-password, reset-password)
3. Login form calls authClient.signIn.email
4. Signup form calls authClient.signUp.email and transitions to verify-otp
5. OTP verification calls authClient.emailOtp.verifyEmail with cooldown and lockout
6. Forgot password calls authClient.emailOtp.requestPasswordReset
7. Reset password calls authClient.emailOtp.resetPassword
8. No toast notifications used anywhere -- all errors inline
9. Split layout: 2-column on lg+, 1-column on mobile
10. GitHub OAuth button visible but disabled with "Coming soon"
</verification>

<success_criteria>
- All auth form views implemented and wired to better-auth client
- Form validation with Zod schemas, inline field errors, and error banners
- OTP input with 6 digit boxes, auto-advance, paste support
- OTP cooldown (1 min) and lockout (30 min / 3 attempts) implemented client-side
- Split layout responsive (form + illustration desktop, form-only mobile)
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-shell-auth-frontend/03-02-SUMMARY.md`
</output>
